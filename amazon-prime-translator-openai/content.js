let o={targetLanguage:"ja",sourceLanguage:"en",showOriginal:!0,showTranslation:!0,fontSize:16,position:"bottom",enabled:!0};function m(){return new Promise(t=>{chrome.storage.sync.get(o,a=>{o=a,t(o)})})}function d(){const t=document.createElement("div");return t.id="amazon-prime-translator-container",t.style.position="absolute",t.style.zIndex="9999",t.style.width="100%",t.style.textAlign="center",t.style.color="white",t.style.textShadow="0 0 2px black",t.style.fontSize=`${o.fontSize}px`,o.position==="bottom"?t.style.bottom="10%":t.style.top="10%",document.body.appendChild(t),t}function f(t){return new Promise(a=>{chrome.runtime.sendMessage({action:"translate",text:t,from:o.sourceLanguage,to:o.targetLanguage},n=>{n&&n.translation?a(n.translation):a(`翻訳エラー: ${t}`)})})}function h(t,a,n){if(n.innerHTML="",o.showOriginal){const e=document.createElement("div");e.className="amazon-prime-translator-original",e.textContent=t,n.appendChild(e)}if(o.showTranslation){const e=document.createElement("div");e.className="amazon-prime-translator-translation",e.style.color="#ffcc00",e.textContent=a,n.appendChild(e)}}function s(){const t=".atvwebplayersdk-captions-text",a=new MutationObserver(e=>{for(const l of e)if(l.type==="childList"||l.type==="characterData"){const i=document.querySelector(t);if(i&&i.textContent){const r=i.textContent.trim();r&&f(r).then(c=>{const u=document.getElementById("amazon-prime-translator-container")||d();h(r,c,u)})}}}),n=()=>{const e=document.querySelector(t);e?(a.observe(e,{childList:!0,subtree:!0,characterData:!0}),console.log("Amazon Prime Translator: 字幕の監視を開始しました")):setTimeout(n,1e3)};n()}async function g(){if(await m(),!o.enabled){console.log("Amazon Prime Translator: 拡張機能は無効になっています");return}console.log("Amazon Prime Translator: 初期化中...");let t=location.href;new MutationObserver(()=>{location.href!==t&&(t=location.href,location.href.includes("amazon")&&(location.href.includes("/gp/video/")||location.href.includes("/watch"))&&setTimeout(s,2e3))}).observe(document,{subtree:!0,childList:!0}),location.href.includes("amazon")&&(location.href.includes("/gp/video/")||location.href.includes("/watch"))&&setTimeout(s,2e3)}g();
